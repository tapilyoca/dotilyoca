%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% MIT LICENSE
%
% Permission is hereby granted, free of charge, to any person or organization
% obtaining a copy of the software and accompanying documentation covered by
% this license (the "Software") to use, reproduce, display, distribute,
% execute, and transmit the Software, and to prepare derivative works of the
% Software, and to permit third-parties to whom the Software is furnished to
% do so, all subject to the following:
%
% The copyright notices in the Software and this entire statement, including
% the above license grant, this restriction and the following disclaimer,
% must be included in all copies of the Software, in whole or in part, and
% all derivative works of the Software, unless such copies or derivative
% works are solely in the form of machine-executable object code generated by
% a source language processor.
%
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
% SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
% FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
% ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
% DEALINGS IN THE SOFTWARE.
%
% by matti campos, last updated 12/26/24
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ProvidesPackage{matti}

% nabbing what evan chen did and adding "matti" to each of these to avoid package conflicts
\newif\ifmattiprobset\mattiprobsetfalse  % problem sets
\newif\ifmattisolns\mattisolnsfalse      % solutions (usually pmo)


\newif\ifmattifancy\mattifancyfalse      % fancy theorems
\newif\ifmatticalc\matticalcfalse        % calculus. mostly shortcuts really
\newif\ifmattiphysics\mattiphysicsfalse  % physics... will add things when physics becomes not calc.
\newif\ifmattiflat\mattiflatfalse        % sans serif
\newif\ifmattidark\mattidarkfalse
\newif\ifmatticheatsheet\matticheatsheetfalse

\DeclareOption{probset}{\matticalctrue\mattiflattrue\mattiphysicstrue}
\DeclareOption{solns}{\mattisolnstrue\mattifancytrue}
\DeclareOption{darkmode}{\mattidarktrue}
\DeclareOption{flat}{\mattiflattrue}
\DeclareOption{cheatsheet}{\matticheatsheettrue\mattiflattrue}

\ProcessOptions


    


%%% SHORTCUTS %%%
  % Math shortcuts, typing shortcuts, etcetera.
  % Note to self: DO NOT USE NATH!!!! AT ALL!!! IT SUCKS!!!

  %% Ubiquitous %%
  \usepackage{amsmath,amssymb,mathtools,gensymb}
  \newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
  \newcommand{\ceil}[1]{\left \lceil #1 \right \rceil}
  \newcommand{\pqt}[1]{\left( #1 \right)}
  \newcommand{\bks}[1]{\left[ #1 \right]}
  \newcommand{\abs}[1]{\left | #1 \right|}
  \newcommand{\ol}{\overline}
  \newcommand{\ul}{\underline}
  \newcommand{\cbrt}[1]{\sqrt[3]{#1}}
  \newcommand{\wt}{\widetilde}
  \newcommand{\hl}[1]{\colorbox{CtpYellow!40}{#1}}
  \newcommand{\wh}{\widehat}
  \newcommand{\eps}{\varepsilon}
  \newcommand{\ang}{\angle}
  \newcommand{\dang}{\measuredangle}
  \newcommand{\tri}{\triangle}
  \newcommand{\case}[2]{\textit{Case #1: #2}}
  \renewcommand{\deg}{\degree}
  \providecommand{\arc}[1]{\wideparen{#1}}
  \renewcommand{\emph}[1]{\textit{#1}}
  %% Colors
    \newcommand{\blu}[1]{\textcolor{CtpBlue}{#1}}
    \newcommand{\red}[1]{\textcolor{CtpMaroon}{#1}}
    \newcommand{\ylw}[1]{\textcolor{CtpYellow}{#1}}
    \newcommand{\grn}[1]{\textcolor{CtpGreen}{#1}}
    \newcommand{\pnk}[1]{\textcolor{CtpPink}{#1}}
    \newcommand{\prp}[1]{\textcolor{CtpMauve}{#1}}
    \newcommand{\lav}[1]{\textcolor{CtpLavender}{#1}}


  %% Solutions
  \ifmattisolns
    \newcommand{\ans}[1]{
      \textbf{Answer: } \fbox{#1}
    }
    \newcommand{\fourch}[4]{ % for 4-choice mulcho
      \par
        \begin{tabular}{*{4}{@{}p{0.25\textwidth}}}
          (a)~#1 & (b)~#2 & (c)~#3 & (d)~#4
        \end{tabular}
    }
  \fi

  %% Calc stuff
  \ifmatticalc
    \newcommand{\dd}[1]{\ensuremath{\frac{\mathrm{d}}{\mathrm{d}x}}}
    \renewcommand{\d}[1]{\ensuremath{\mathrm{d} #1}}
    \newcommand{\limt}[2]{\ensuremath{\lim_{#1 \to #2}}}
  \fi

  %% physics stuff
  \ifmattiphysics
    \usepackage{bm}
    \newcommand{\uvec}[1]{\bm{\hat{\textbf{\fontfamily{cmr}\selectfont #1}}}}
  \fi


%%% SETUP ENVIRONMENTS %%%

  %% These are mostly nabbed from Evan Chen's .sty file, with color swaps.
  %% Do note that you need the catppuccinpalette .sty file installed.
  %% Otherwise, you'll get an error.

  %% Ubiquitous
  \usepackage[framemethod=tikz]{mdframed}
  \usepackage{amsthm, thmtools}
  \usepackage[dvipsnames]{xcolor}
  \ifmattidark
    \usepackage[mocha, textcolor=true, pagecolor=true]{catppuccinpalette}
  \else
    \usepackage[latte, pagecolor=false]{catppuccinpalette}
  \fi
  \mdfdefinestyle{mdbluebox}{%
    roundcorner=5pt,
    linewidth=1.5pt,
    skipabove=12pt,
    innerbottommargin=9pt,
    skipbelow=2pt,
    linecolor=CtpBlue,
    nobreak=true,
    backgroundcolor=CtpBlue!5,
  }
  \declaretheoremstyle[
    headfont=\normalfont\bfseries\color{CtpText},
    spaceabove=8pt,
    spacebelow=8pt,
    bodyfont=\normalfont
  ]{basehead}
  \declaretheoremstyle[
    headfont=\sffamily\bfseries\color{CtpBlue},
    bodyfont=\normalfont,
    mdframed={style=mdbluebox},
    headpunct={\\[3pt]},
    postheadspace={0pt}
  ]{thmbluebox}
  \mdfdefinestyle{mdremark}{%
    skipabove=8pt,
    linewidth=3pt,
    rightline=false,
    leftline=true,
    topline=false,
    bottomline=false,
    linecolor=CtpBlue,
    backgroundcolor=CtpBlue!3!CtpBase!50
  }
  \declaretheoremstyle[
    headfont=\sffamily\bfseries\color{CtpBlue},
    bodyfont=\normalfont\small\color{black},
    spaceabove=0pt,
    spacebelow=0pt,
    mdframed={style=mdremark}
  ]{thmremark}
  \mdfdefinestyle{mdgreenbox}{%
    skipabove=8pt,
    skipbelow=0pt,
    linewidth=2pt,
    rightline=false,
    leftline=true,
    topline=false,
    bottomline=false,
    linecolor=CtpGreen,
    backgroundcolor=CtpGreen!15,
  }
  \declaretheoremstyle[
    headfont=\bfseries\sffamily\color{CtpGreen!70!black},
    bodyfont=\normalfont,
    spaceabove=2pt,
    spacebelow=1pt,
    mdframed={style=mdgreenbox},
    headpunct={ --- },
  ]{thmgreenbox}
    
  
  \declaretheorem[style=thmbluebox,name=Theorem]{theorem}
  \declaretheorem[style=basehead,name=Problem,sibling=theorem]{problem}
  \declaretheorem[style=basehead,name=Definition,sibling=theorem]{definition}
  \declaretheorem[style=thmbluebox,name=Lemma,sibling=theorem]{lemma}
  \declaretheorem[style=thmgreenbox,name=Claim,sibling=theorem]{claim}
  \declaretheorem[style=thmremark,name=Remark,sibling=theorem]{remark}
  \newenvironment{soln}[1][Solution]{\begin{proof}[\textit{#1}]}{\end{proof}}
  \newenvironment{soln*}[1][Solution]{\begin{proof}[\textit{#1}]}{\end{proof}}

  \ifmattisolns
  \fi


%%% FORMATTING %%%
  %% Ubiquitous

  %% TITLE SETUP
  \addtokomafont{subtitle}{\Large}
  \setkomafont{author}{\Large\scshape}
  \setkomafont{date}{\Large\normalsize}

  \providecommand{\thetitle}{\@title}
  \providecommand{\theauthor}{\@author}
  \providecommand{\thedate}{\@date}


  %% MATH SETUP
  \usepackage{mleftright}
  \mleftright
  \delimitershortfall-1sp


  \ifmattisolns
    \usepackage{tikz}
    \usepackage{paralist} % 0-indent lists
    \setlength\parindent{0pt} % remove paragraph indenting
 
    \makeatletter
    \renewcommand\@seccntformat[1]{\color{red} {\csname the#1 \endcsname}\hspace{0.5em}}
    \makeatother
    \usepackage{sectsty}
    \allsectionsfont{\rmfamily}
  \fi

  %% HEADINGS SETUP
  \ifmattiphysics
    \usepackage{fancyhdr}
    \setlength\parindent{0pt}
    \pagestyle{fancy}
    \chead
    \fancyhead{}
    \fancyhead[C]{INTEGRITY * EXCELLENCE * SERVICE}
  \else
    \ifmatticheatsheet
      \usepackage[margin=0.75in]{geometry} % Optional: Adjust margins
      \pagestyle{empty}
    \else 
      \usepackage[headsepline]{scrlayer-scrpage}
      \renewcommand{\headfont}{}
      \addtolength{\textheight}{3.14cm}
      \setlength{\footskip}{0.5in}
      \setlength{\headsep}{10pt}
      \ihead{\footnotesize\textbf{\theauthor} --- \thedate}
      \automark{section}
      \chead{}
      \ohead{\footnotesize\textbf{\thetitle}}
      \cfoot{\pagemark}
    \fi
  \fi

  \ifmattiflat
    \renewcommand{\familydefault}{\sfdefault}
  \fi

    %% SECTIONS SETUP
    \usepackage{titlesec} 
    \ifmatticheatsheet
      \setcounter{secnumdepth}{-1} % wipe numbering 
      \titleformat{\section}
        {\normalfont\large\bfseries\color{CtpRed}}
        {}{0.5em}{} 
      \titleformat{\subsection}
        {\normalfont\bfseries\color{CtpRed}} 
        {}{0.5em}{} 
      % ideally a cheat sheet doesn't have any subsubsections
      % if it does, it's probably a terrible cheat sheet
      % to emphasize that point...
      \titleformat{\subsubsection}
        {\normalfont\HUGE\bfseries}
        {\textcolor{CtpRed}{DO NOT DO THIS DO NOT DO THIS}}
        {999em}
        {}

      \else 
      \titleformat{\section}
        {\normalfont\Large\bfseries} 
        {\textcolor{CtpRed}{\S\thesection}} 
        {0.75em} 
        {} 
      \titleformat{\subsection}
        {\normalfont\large\bfseries} 
        {\textcolor{CtpRed}{\S\thesubsection}} 
        {0.5em} 
        {} 
      \titleformat{\subsubsection}
        {\normalfont\large\bfseries} 
        {\textcolor{CtpRed}{\S\thesubsubsection}} 
        {0.35em}
        {}
    \fi 

%%% PACKAGES %%%
  % For packages, obviously.
  % Not all packages are here (most aren't).
  % These are just packages that are used for the type of file but not in this .sty file.
  
  %% Ubiquitous %%
  \usepackage[colorlinks=true]{hyperref}
  \hypersetup{linkcolor=NavyBlue}
  \ifmattiphysics
    \usepackage{siunitx}
  \fi

